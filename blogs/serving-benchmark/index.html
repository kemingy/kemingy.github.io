<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>
Cyanide - Deep Learning Serving Benchmark
</title>

    <link rel="stylesheet" href="https://blog.mapotofu.org/style.css">

    
    <link rel="alternate" type="application/atom+xml" title="RSS"
        href="https://blog.mapotofu.org/atom.xml">
    

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
        integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
        integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz"
        crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
        integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
        onload="renderMathInElement(document.body, {delimiters:[
        {left: '$$', right: '$$', display: true},
        {left: '\\[', right: '\\]', display: true},
        {left: '$', right: '$', display: false},
        {left: '\\(', right: '\\)', display: false}]});"></script>
    

    
<meta name="google-site-verification" content="OEmuX--u8eJZ_sTIR-hUG85I8snl3z0En6PspWN-OJQ" />
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ–‹</text></svg>">

</head>

<body>
    <div class="container">
        <div class="mobile-navbar">
            <div class="mobile-header">
                <a href="/" class="title">Cyanide</a>
            </div>
            <div class="mobile-navbar-icon icon-out" id="mobile-nav-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <nav class="mobile-menu" id="mobile-menu">
            <ul class="mobile-menu-list">
                
                <li class="mobile-menu-item">
                    <a href="https:&#x2F;&#x2F;blog.mapotofu.org">
                        Home
                    </a>
                </li>
                
                <li class="mobile-menu-item">
                    <a href="https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;categories">
                        Categories
                    </a>
                </li>
                
                <li class="mobile-menu-item">
                    <a href="https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;archive">
                        Archive
                    </a>
                </li>
                
                <li class="mobile-menu-item">
                    <a href="https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;about">
                        About
                    </a>
                </li>
                
                <li class="mobile-menu-item">
                    <a href="https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;projects">
                        Projects
                    </a>
                </li>
                
            </ul>
        </nav>

        <header>
            <div class="title">
                <a href="https:&#x2F;&#x2F;blog.mapotofu.org">Cyanide</a>
            </div>
            <nav class="menu">
                <ul>
                    
                    <li>
                        <a href="https:&#x2F;&#x2F;blog.mapotofu.org">
                            Home
                        </a>
                    </li>
                    
                    <li>
                        <a href="https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;categories">
                            Categories
                        </a>
                    </li>
                    
                    <li>
                        <a href="https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;archive">
                            Archive
                        </a>
                    </li>
                    
                    <li>
                        <a href="https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;about">
                            About
                        </a>
                    </li>
                    
                    <li>
                        <a href="https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;projects">
                            Projects
                        </a>
                    </li>
                    
                </ul>
            </nav>
        </header>

        <hr class="gradient">

        <main>
            <div class="content">
                

<div class="toc">
    <h2 class="toc-title">Contents</h2>
    <div class="toc-content always-active">
        <ul>
            
            <li>
                <a href="https://blog.mapotofu.org/blogs/serving-benchmark/#what-does-the-deep-learning-serving-frameworks-do" class="toc-link">What does the deep learning serving frameworks do?</a>
                
            </li>
            
            <li>
                <a href="https://blog.mapotofu.org/blogs/serving-benchmark/#benchmark" class="toc-link">Benchmark</a>
                
            </li>
            
            <li>
                <a href="https://blog.mapotofu.org/blogs/serving-benchmark/#comparing" class="toc-link">Comparing</a>
                
                <ul>
                    
                    <li>
                        <a href="https://blog.mapotofu.org/blogs/serving-benchmark/#tensorflow-serving" class="toc-link">Tensorflow Serving</a>
                    </li>
                    
                    <li>
                        <a href="https://blog.mapotofu.org/blogs/serving-benchmark/#triton-inference-server" class="toc-link">Triton Inference Server</a>
                    </li>
                    
                    <li>
                        <a href="https://blog.mapotofu.org/blogs/serving-benchmark/#multi-model-server" class="toc-link">Multi Model Server</a>
                    </li>
                    
                    <li>
                        <a href="https://blog.mapotofu.org/blogs/serving-benchmark/#graphpipe" class="toc-link">GraphPipe</a>
                    </li>
                    
                    <li>
                        <a href="https://blog.mapotofu.org/blogs/serving-benchmark/#torchserve" class="toc-link">TorchServe</a>
                    </li>
                    
                </ul>
                
            </li>
            
        </ul>
    </div>
</div>


<article class="post">
    <div class="post-title">
        <a href="https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;blogs&#x2F;serving-benchmark&#x2F;">Deep Learning Serving Benchmark</a>
    </div>
    <div class="post-meta">
        <span class="post-time">
            ðŸ“… 2020-04-22
        </span>
        <span class="post-reading-time">
            âŒ› 3 min
        </span>
        
        <div class="post-category">
            
            <a href="https://blog.mapotofu.org/categories/deep-learning/">
                Deep Learning
            </a>
            
            <a href="https://blog.mapotofu.org/categories/technology/">
                Technology
            </a>
            
            <a href="https://blog.mapotofu.org/categories/data-science/">
                Data Science
            </a>
            
        </div>
        
    </div>
    <div class="post-content">
        <p>There is no black magic, everything follows the rules.</p>
<span id="continue-reading"></span><h2 id="what-does-the-deep-learning-serving-frameworks-do">What does the deep learning serving frameworks do?</h2>
<ul>
<li>respond to request (RESTful HTTP or RPC)</li>
<li>model inference (with runtime)</li>
<li>preprocessing &amp; postprocessing (optional)</li>
<li>queries dynamic batching (increase throughput)</li>
<li>monitoring metrics</li>
<li>service health check</li>
<li>versioning</li>
<li>multiple instances</li>
</ul>
<p>Actually, when we are trying to deploy the models with kubernetes, we only need part of these features. But we do care about the performance of these frameworks. So let's do a benchmark.</p>
<h2 id="benchmark">Benchmark</h2>
<p><strong>Environments</strong>:</p>
<ul>
<li>CPU: Intel(R) Xeon(R) Gold 6130 CPU @ 2.10GHz</li>
<li>GPU: NVIDIA V100</li>
<li>Memory: 251GiB</li>
<li>OS: Ubuntu 16.04.6 LTS (Xenial Xerus)</li>
</ul>
<p><strong>Docker Images</strong>:</p>
<ul>
<li>tensorflow/tensorflow:latest-gpu</li>
<li>tensorflow/serving:latest-gpu</li>
<li>nvcr.io/nvidia/tensorrtserver:19.10-py3</li>
</ul>
<p>The cost of time is recorded after <strong>warmup</strong>. Dynamic batching <strong>disabled</strong>.</p>
<p>All the code can be found in this <a href="https://gist.github.com/kemingy/a382528b29f6e34c47b464cf16806731">gist</a>.</p>
<table><thead><tr><th align="center">Framework</th><th align="center">Model</th><th align="center">Model Type</th><th align="center">Images</th><th align="center">Batch size</th><th align="center">Time(s)</th></tr></thead><tbody>
<tr><td align="center">Tensorflow</td><td align="center">ResNet50</td><td align="center">TF Savedmodel</td><td align="center">32000</td><td align="center">32</td><td align="center">83.189</td></tr>
<tr><td align="center">Tensorflow</td><td align="center">ResNet50</td><td align="center">TF Savedmodel</td><td align="center">32000</td><td align="center">10</td><td align="center">86.897</td></tr>
<tr><td align="center">Tensorflow Serving</td><td align="center">ResNet50</td><td align="center">TF Savedmodel</td><td align="center">32000</td><td align="center">32</td><td align="center">120.496</td></tr>
<tr><td align="center">Tensorflow Serving</td><td align="center">ResNet50</td><td align="center">TF Savedmodel</td><td align="center">32000</td><td align="center">10</td><td align="center">116.887</td></tr>
<tr><td align="center">Triton (TensorRT Inference Server)</td><td align="center">ResNet50</td><td align="center">TF Savedmodel</td><td align="center">32000</td><td align="center">32</td><td align="center">201.855</td></tr>
<tr><td align="center">Triton (TensorRT Inference Server)</td><td align="center">ResNet50</td><td align="center">TF Savedmodel</td><td align="center">32000</td><td align="center">10</td><td align="center">171.056</td></tr>
<tr><td align="center">Falcon + msgpack + Tensorflow</td><td align="center">ResNet50</td><td align="center">TF Savedmodel</td><td align="center">32000</td><td align="center">32</td><td align="center">115.686</td></tr>
<tr><td align="center">Falcon + msgpack + Tensorflow</td><td align="center">ResNet50</td><td align="center">TF Savedmodel</td><td align="center">32000</td><td align="center">10</td><td align="center">115.572</td></tr>
</tbody></table>
<p>According to the benchmark, Triton is not ready for production, TF Serving is a good option for TensorFlow models, and self-host service is also quite good (you may need to implement dynamic batching for production).</p>
<h2 id="comparing">Comparing</h2>
<h3 id="tensorflow-serving">Tensorflow Serving</h3>
<p><a href="https://www.tensorflow.org/tfx/serving">https://www.tensorflow.org/tfx/serving</a></p>
<ul>
<li>coupled with Tensorflow ecosystem (also support other format, not out-of-box)</li>
<li>A/B testing</li>
<li>provide both gRPC and HTTP RESTful API</li>
<li>prometheus integration</li>
<li>batching</li>
<li>multiple models</li>
<li>preprocessing &amp; postprocessing can be implemented with <a href="https://github.com/tensorflow/tensorflow/issues/31055">signatures</a></li>
</ul>
<h3 id="triton-inference-server">Triton Inference Server</h3>
<p><a href="https://github.com/NVIDIA/triton-inference-server/">https://github.com/NVIDIA/triton-inference-server/</a></p>
<ul>
<li>support multiply backends: ONNX, PyTorch, TensorFlow, Caffe2, TensorRT</li>
<li>both gRPC and HTTP with SDK</li>
<li>internal health check and prometheus metrics</li>
<li>batching</li>
<li>concurrent model execution</li>
<li>preprocessing &amp; postprocessing can be done with ensemble models</li>
<li><code>shm-size</code>, <code>memlock</code>, <code>stack</code> configurations are not available for Kubernetes</li>
</ul>
<h3 id="multi-model-server">Multi Model Server</h3>
<p><a href="https://github.com/awslabs/multi-model-server">https://github.com/awslabs/multi-model-server</a></p>
<ul>
<li>require Java 8</li>
<li>provide HTTP</li>
<li>Java layer communicates with Python workers through Unix Domain Socket or TCP</li>
<li>batching (not mature)</li>
<li>multiple models</li>
<li><code>log4j</code></li>
<li>management API</li>
<li>need to write model loading and inference code (means can use any runtime you want)</li>
<li>easy to add preprocessing and postprocessing to the service</li>
</ul>
<h3 id="graphpipe">GraphPipe</h3>
<p><a href="https://oracle.github.io/graphpipe">https://oracle.github.io/graphpipe</a></p>
<ul>
<li>use flatbuffer which is more efficient</li>
<li>2 years ago...</li>
<li>Oracle laid off the whole team</li>
</ul>
<h3 id="torchserve">TorchServe</h3>
<p><a href="https://github.com/pytorch/serve">https://github.com/pytorch/serve</a></p>
<ul>
<li>fork from Multi Model Server</li>
<li>developing...</li>
</ul>

    </div>

    <div class="post-before-footer">
        
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License"
        style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a><br />This work is
licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons
    Attribution-NonCommercial-ShareAlike 4.0 International License</a>.

    </div>

    <div class="post-footer">
        
            
            <div class="post-nav">
                
                <a class="previous" href="https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;blogs&#x2F;rate-limiter&#x2F;">â€¹ Rate Limiter Implementation</a>
                
                
                <a class="next" href="https:&#x2F;&#x2F;blog.mapotofu.org&#x2F;blogs&#x2F;deep-learning-serving&#x2F;">Deep Learning Serving Framework â€º</a>
                
                
                
            </div>
            
        
    </div>
</article>

            </div>
        </main>

        
        
    </div>

    
    <script src="https://blog.mapotofu.org/script.js"></script>
    
</body>

</html>